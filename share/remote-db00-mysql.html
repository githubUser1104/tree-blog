<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>mysql | Tree-Blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/tree-blog/images/logo.svg">
    <meta name="description" content="">
    
    <link rel="preload" href="/tree-blog/assets/css/0.styles.07f5b1e1.css" as="style"><link rel="preload" href="/tree-blog/assets/js/app.cb601673.js" as="script"><link rel="preload" href="/tree-blog/assets/js/2.5b88b558.js" as="script"><link rel="preload" href="/tree-blog/assets/js/14.3f58ed78.js" as="script"><link rel="prefetch" href="/tree-blog/assets/js/10.434a7da1.js"><link rel="prefetch" href="/tree-blog/assets/js/11.c75c1870.js"><link rel="prefetch" href="/tree-blog/assets/js/12.cbf9b0e8.js"><link rel="prefetch" href="/tree-blog/assets/js/13.b4eb1003.js"><link rel="prefetch" href="/tree-blog/assets/js/15.a8748cd5.js"><link rel="prefetch" href="/tree-blog/assets/js/16.a9d2cb17.js"><link rel="prefetch" href="/tree-blog/assets/js/17.0e657c23.js"><link rel="prefetch" href="/tree-blog/assets/js/18.166991cb.js"><link rel="prefetch" href="/tree-blog/assets/js/3.79d3c432.js"><link rel="prefetch" href="/tree-blog/assets/js/4.b305f6a6.js"><link rel="prefetch" href="/tree-blog/assets/js/5.835102ac.js"><link rel="prefetch" href="/tree-blog/assets/js/6.73b5fbe6.js"><link rel="prefetch" href="/tree-blog/assets/js/7.38ee6a4a.js"><link rel="prefetch" href="/tree-blog/assets/js/8.c46c148f.js"><link rel="prefetch" href="/tree-blog/assets/js/9.dbe52f72.js">
    <link rel="stylesheet" href="/tree-blog/assets/css/0.styles.07f5b1e1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/tree-blog/" class="home-link router-link-active"><!----> <span class="site-name">Tree-Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/tree-blog/share/remote-db00-mysql.html" aria-current="page" class="active sidebar-link">mysql</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tree-blog/share/remote-db00-mysql.html#相关概念" class="sidebar-link">相关概念</a></li><li class="sidebar-sub-header"><a href="/tree-blog/share/remote-db00-mysql.html#mysql-安装-mac" class="sidebar-link">mysql - 安装(mac)</a></li><li class="sidebar-sub-header"><a href="/tree-blog/share/remote-db00-mysql.html#修改密码" class="sidebar-link">修改密码</a></li><li class="sidebar-sub-header"><a href="/tree-blog/share/remote-db00-mysql.html#mysql-基础命令" class="sidebar-link">mysql - 基础命令</a></li><li class="sidebar-sub-header"><a href="/tree-blog/share/remote-db00-mysql.html#mysql-数据类型" class="sidebar-link">mysql - 数据类型</a></li><li class="sidebar-sub-header"><a href="/tree-blog/share/remote-db00-mysql.html#mysql-表管理" class="sidebar-link">mysql - 表管理</a></li><li class="sidebar-sub-header"><a href="/tree-blog/share/remote-db00-mysql.html#mysql-查询数据" class="sidebar-link">mysql - 查询数据</a></li><li class="sidebar-sub-header"><a href="/tree-blog/share/remote-db00-mysql.html#mysql-修改数据" class="sidebar-link">mysql - 修改数据</a></li><li class="sidebar-sub-header"><a href="/tree-blog/share/remote-db00-mysql.html#mysql-子查询" class="sidebar-link">mysql - 子查询</a></li><li class="sidebar-sub-header"><a href="/tree-blog/share/remote-db00-mysql.html#mysql-cte-公共表达式" class="sidebar-link">mysql - CTE（公共表达式）</a></li><li class="sidebar-sub-header"><a href="/tree-blog/share/remote-db00-mysql.html#mysql-准备语句" class="sidebar-link">mysql - 准备语句</a></li><li class="sidebar-sub-header"><a href="/tree-blog/share/remote-db00-mysql.html#mysql-临时表" class="sidebar-link">mysql - 临时表</a></li><li class="sidebar-sub-header"><a href="/tree-blog/share/remote-db00-mysql.html#mysql-视图" class="sidebar-link">mysql - 视图</a></li><li class="sidebar-sub-header"><a href="/tree-blog/share/remote-db00-mysql.html#mysql-触发器" class="sidebar-link">mysql - 触发器</a></li><li class="sidebar-sub-header"><a href="/tree-blog/share/remote-db00-mysql.html#mysql-全文搜索" class="sidebar-link">mysql - 全文搜索</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mysql"><a href="#mysql" class="header-anchor">#</a> mysql</h1> <p><a href="https://www.mysql.com/cn/" target="_blank" rel="noopener noreferrer">官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://www.yiibai.com/mysql/basic-mysql.html" target="_blank" rel="noopener noreferrer">中文教程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="相关概念"><a href="#相关概念" class="header-anchor">#</a> 相关概念</h2> <ul><li>SQL
<ul><li>数据定义语言DDL：包含定义数据库及其对象的语句，例如表，视图，触发器，存储过程等。</li> <li>数据操作语言DML：包含允许您更新和查询数据的语句。</li> <li>数据控制语言DCL：允许授予用户权限访问数据库中特定数据的权限。</li> <li>事务控制语言TCL：设置保存点、回滚、提交</li></ul></li> <li>数据库对象：包括视图、</li></ul> <h2 id="mysql-安装-mac"><a href="#mysql-安装-mac" class="header-anchor">#</a> mysql - 安装(mac)</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>1. 访问https://downloads.mysql.com/archives/community/
2. 选择5.7.20 macOS DMG
3. 根据向导安装，记录临时密码：S=GX/s&lt;2h-np
4. 系统偏好设置 -&gt; mysql -&gt; 开机自启动复选框，Start MySQL Server 
5. 为Path路径附加MySQL的bin目录: PATH=&quot;$PATH&quot;:/usr/local/mysql/bin
5.1 创建软链让命令行能识别mysql：cd /usr/local/bin &amp;&amp; sudo ln -fs /usr/local/mysql/bin/mysql mysql
6. 检查mysql版本(这里是5.7.20) mysql --version 
7. 通过命令行登录：mysql -u root -p 需要输入临时密码
8. 重设密码为root：set PASSWORD =PASSWORD('root');
9. 查看数据库信息：show databases;
10. 使用指定的数据库：use mysql;
11. 查看表字段信息：desc db;
12. 退出：exit;
13. 通过Navicat Premium连接mysql：账号密码 root / root 主机 localhost 端口 3306
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="修改密码"><a href="#修改密码" class="header-anchor">#</a> 修改密码</h2> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 奇怪的是mysql并没有添加到终端的bin中，所以找不到mysql时，需要输入下面一句，再使用mysql</span>
<span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token string">&quot;<span class="token environment constant">$PATH</span>&quot;</span>:/usr/local/mysql/bin
mysql <span class="token parameter variable">-u</span> root <span class="token parameter variable">-p</span>
<span class="token comment"># 输入原本的密码</span>
<span class="token builtin class-name">set</span> PASSWORD <span class="token operator">=</span>PASSWORD<span class="token punctuation">(</span><span class="token string">'MYSQLmysql123456?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="mysql-基础命令"><a href="#mysql-基础命令" class="header-anchor">#</a> mysql - 基础命令</h2> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 登录</span>
mysql <span class="token parameter variable">-u</span> root <span class="token parameter variable">-p</span>
<span class="token comment"># 查看所有数据库</span>
SHOW databases<span class="token punctuation">;</span>
<span class="token comment"># 使用某个数据库</span>
use xxx
<span class="token comment"># 查看所有表和视图</span>
SHOW FULL TABLES<span class="token punctuation">;</span>
<span class="token comment"># 查看表字段信息</span>
desc table1<span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="mysql-数据类型"><a href="#mysql-数据类型" class="header-anchor">#</a> mysql - 数据类型</h2> <ul><li><a href="https://www.yiibai.com/mysql/data-types.html" target="_blank" rel="noopener noreferrer">参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>常用：int varchar JSON</li> <li>varchar(n)表示n个字符，无论汉字和英文，Mysql都能存入n个字符，仅是实际字节长度有所区别</li> <li>一个英文字母占用一个字节</li> <li>一个中文汉字占多少字节与编码有关
<ul><li>UTF8：一个中文汉字＝3个字节</li> <li>GBK：一个中文汉字＝2个字节</li></ul></li></ul> <h2 id="mysql-表管理"><a href="#mysql-表管理" class="header-anchor">#</a> mysql - 表管理</h2> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 创建表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> tasks <span class="token punctuation">(</span>
  task_id <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  subject <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  start_date <span class="token keyword">DATE</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  end_date <span class="token keyword">DATE</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  description <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>task_id<span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span><span class="token punctuation">;</span>


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="mysql-查询数据"><a href="#mysql-查询数据" class="header-anchor">#</a> mysql - 查询数据</h2> <ul><li><p><a href="https://www.yiibai.com/mysql/what-is-mysql.html#" target="_blank" rel="noopener noreferrer">参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>实践环境：阿里云ECS</p></li> <li><p>查询语句的语法(注意：大小写不敏感)</p></li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span>
    column_1<span class="token punctuation">,</span> column_2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">FROM</span>
    table_1
<span class="token punctuation">[</span><span class="token keyword">INNER</span> <span class="token operator">|</span> <span class="token keyword">LEFT</span> <span class="token operator">|</span><span class="token keyword">RIGHT</span><span class="token punctuation">]</span> <span class="token keyword">JOIN</span> table_2 <span class="token keyword">ON</span> conditions
<span class="token keyword">WHERE</span>
    conditions
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> column_1
<span class="token keyword">HAVING</span> group_conditions
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> column1 <span class="token punctuation">[</span><span class="token keyword">ASC</span><span class="token operator">|</span><span class="token keyword">DESC</span><span class="token punctuation">]</span><span class="token punctuation">,</span> column2 <span class="token punctuation">[</span><span class="token keyword">ASC</span><span class="token operator">|</span><span class="token keyword">DESC</span><span class="token punctuation">]</span>
<span class="token keyword">LIMIT</span> <span class="token keyword">offset</span><span class="token punctuation">,</span> length<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li>SELECT FROM 最基础的查询</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> lastname<span class="token punctuation">,</span> firstname<span class="token punctuation">,</span> jobtitle <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>DISTINCT 消除结果集中的重复行，同样的NULL行也会视为重复，多列的情况下需要组合所有列判断是否重复</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> country<span class="token punctuation">,</span> city <span class="token keyword">FROM</span> customers <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> country<span class="token punctuation">,</span> city<span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> country<span class="token punctuation">,</span> city <span class="token keyword">FROM</span> customers <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> country<span class="token punctuation">,</span> city<span class="token punctuation">;</span>

<span class="token comment">-- 结合函数使用</span>
<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> city<span class="token punctuation">)</span> <span class="token keyword">FROM</span> customers <span class="token keyword">WHERE</span> country <span class="token operator">=</span> <span class="token string">'USA'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>WHERE 过滤数据
<ul><li>逻辑运算符(短路规则)：
<ul><li>AND</li> <li>OR</li> <li>IN(NOT IN)</li> <li>BETWEEN(NOT BETWEEN)</li> <li>LIKE(NOT LIKE)</li> <li><a href="https://www.yiibai.com/mysql/regular-expression-regexp.html" target="_blank" rel="noopener noreferrer">REGEXP 正则<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>LIMIT</li> <li>IS NULL(IS NOT NULL)</li> <li>注意and的优先级大于or，通常使用括号就不用硬记了：<code>SELECT (true OR false) AND false;</code></li></ul></li> <li>比较运算符：=  !=或&lt;&gt;  &gt;  &gt;=  &lt;  &lt;=</li> <li>LIKE(NOT LIKE)
<ul><li>注意：匹配的模式不区分大小写，如果需要区分就在like 前面加上 BINARY 关键字</li> <li>百分比(%)通配符允许匹配任何字符串的零个或多个字符
<ul><li><code>WHERE firstname LIKE 'a%';</code> 以a(A)开头</li> <li><code>WHERE firstname LIKE '%on';</code> 以on(..)结尾</li> <li><code>WHERE firstname LIKE BINARY '%on%';</code> 包含on, 前后没有字符也可以</li></ul></li> <li>下划线(_)通配符允许匹配任何单个字符
<ul><li><code>WHERE firstname LIKE 'T_m';</code></li></ul></li> <li>转义：默认反斜杠，也可以通过ESCAPE子句指定转义字符
<ul><li><code>WHERE productCode LIKE '%\_20%';</code></li> <li><code>WHERE productCode LIKE '%$_20%' ESCAPE '$';</code></li></ul></li></ul></li></ul></li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- AND</span>
<span class="token keyword">SELECT</span> lastname<span class="token punctuation">,</span> firstname<span class="token punctuation">,</span> jobtitle<span class="token punctuation">,</span> officeCode <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> jobTitle <span class="token operator">=</span> <span class="token string">'Sales Rep'</span> <span class="token operator">AND</span> officeCode <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">-- OR 查找购买价格不在20到100(含20到100)之间的产品</span>
<span class="token keyword">SELECT</span> productName<span class="token punctuation">,</span> buyPrice <span class="token keyword">from</span> products <span class="token keyword">WHERE</span> buyPrice <span class="token operator">&lt;</span> <span class="token number">20</span> <span class="token operator">OR</span> buyPrice <span class="token operator">&gt;</span> <span class="token number">100</span><span class="token punctuation">;</span>

<span class="token comment">-- NOT BETWEEN 查找购买价格不在20到100(含20到100)之间的产品</span>
<span class="token keyword">SELECT</span> productName<span class="token punctuation">,</span> buyPrice <span class="token keyword">from</span> products <span class="token keyword">WHERE</span> buyPrice <span class="token operator">NOT</span> <span class="token operator">BETWEEN</span> <span class="token number">20</span> <span class="token operator">AND</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token comment">-- BETWEEN 查询获取所需日期(requiredDate)从2013-01-01到2013-01-31的所有订单</span>
<span class="token keyword">SELECT</span> orderNumber<span class="token punctuation">,</span> requiredDate <span class="token keyword">FROM</span> orders <span class="token keyword">WHERE</span> requiredDate <span class="token operator">BETWEEN</span> CAST<span class="token punctuation">(</span><span class="token string">'2013-01-01'</span> <span class="token keyword">AS</span> <span class="token keyword">DATE</span><span class="token punctuation">)</span> <span class="token operator">AND</span> CAST<span class="token punctuation">(</span><span class="token string">'2013-01-31'</span> <span class="token keyword">AS</span> <span class="token keyword">DATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- IN (NOT IN)也可以用OR实现，但是在多条件的情况下语句会很长</span>
<span class="token keyword">SELECT</span> city<span class="token punctuation">,</span> country <span class="token keyword">FROM</span> offices <span class="token keyword">WHERE</span> country <span class="token operator">NOT</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'USA'</span><span class="token punctuation">,</span> <span class="token string">'France'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- IN 结合子查询：结合orders和orderdetails两张表，查找总金额大于60000的订单</span>
<span class="token keyword">SELECT</span> orderNumber<span class="token punctuation">,</span> customerNumber<span class="token punctuation">,</span> shippedDate <span class="token keyword">from</span> orders <span class="token keyword">WHERE</span> orderNumber <span class="token operator">IN</span>
<span class="token punctuation">(</span><span class="token keyword">SELECT</span> orderNumber <span class="token keyword">FROM</span> orderdetails <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> orderNumber <span class="token keyword">HAVING</span> <span class="token function">SUM</span><span class="token punctuation">(</span>quantityOrdered <span class="token operator">*</span> priceEach<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">60000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- LIKE(NOT LIKE) 模糊查询，结合BINARY区分大小写，使用反斜杠转义</span>
    <span class="token comment">-- 百分比(%)通配符允许匹配任何字符串的零个或多个字符</span>
    <span class="token comment">-- 下划线(_)通配符允许匹配任何单个字符</span>
<span class="token keyword">SELECT</span> employeeNumber<span class="token punctuation">,</span> firstName <span class="token keyword">from</span> employees <span class="token keyword">WHERE</span> firstName <span class="token operator">LIKE</span> <span class="token string">'T_m'</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> employeeNumber<span class="token punctuation">,</span> firstName <span class="token keyword">from</span> employees <span class="token keyword">WHERE</span> firstName <span class="token operator">NOT</span> <span class="token operator">LIKE</span> <span class="token keyword">BINARY</span> <span class="token string">'A%'</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> productCode<span class="token punctuation">,</span> productName <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> productCode <span class="token operator">LIKE</span> <span class="token string">'%\_20%'</span><span class="token punctuation">;</span>

<span class="token comment">-- REGEXP 正则</span>
<span class="token comment">-- 找出名字以字母A，B或C开头的产品; 结合BINARY区分大小写</span>
<span class="token keyword">SELECT</span> productname <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> productname <span class="token operator">REGEXP</span> <span class="token keyword">BINARY</span> <span class="token string">'^(A|B|C)'</span><span class="token punctuation">;</span>



<span class="token comment">-- LIMIT 限制结果集的行数，传一个参数(行数)，传两个参数(偏移量, 行数)</span>
<span class="token keyword">SELECT</span> customerNumber<span class="token punctuation">,</span> customerName <span class="token keyword">FROM</span> customers <span class="token keyword">LIMIT</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> customerNumber<span class="token punctuation">,</span> customerName <span class="token keyword">FROM</span> customers <span class="token keyword">LIMIT</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token comment">-- LIMIT 结合排序求最大值和最小值</span>
<span class="token keyword">SELECT</span> customerName<span class="token punctuation">,</span> creditLimit <span class="token keyword">FROM</span> customers <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> creditLimit <span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> customerName<span class="token punctuation">,</span> creditLimit <span class="token keyword">FROM</span> customers <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> creditLimit <span class="token keyword">ASC</span> <span class="token keyword">LIMIT</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token comment">-- LIMIT偏移 结合排序求第N贵的产品=&gt; 对应偏移量为 N-1</span>
<span class="token keyword">SELECT</span> productCode<span class="token punctuation">,</span> productName<span class="token punctuation">,</span> buyPrice <span class="token keyword">FROM</span> products <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> buyPrice <span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">-- IS NULL(IS NOT NULL) 查询有销售代表的客户</span>
<span class="token keyword">SELECT</span> customerName<span class="token punctuation">,</span> salesRepEmployeeNumber <span class="token keyword">FROM</span> customers <span class="token keyword">WHERE</span> salesRepEmployeeNumber <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><ul><li>AS别名：
<ul><li>包括列别名和表别名</li> <li>增强可读性，简化sql，AS关键字可以省略</li> <li>可以在ORDER BY、GROUP BY和HAVING子句中使用列别名</li> <li>不可以在WHERE子句中使用列别名</li></ul></li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 给组合列起别名，如果别名中包含空格需要使用``设置为整体</span>
<span class="token keyword">SELECT</span> CONCAT_WS<span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">,</span> lastName<span class="token punctuation">,</span> firstName<span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>Full name<span class="token punctuation">`</span></span> <span class="token keyword">from</span> employees<span class="token punctuation">;</span>

<span class="token comment">-- 给不同的表起别名，方便对同名列进行区分，如果不起别名的话，需要使用表名全称，容易导致sql过长</span>
<span class="token keyword">SELECT</span> customerName<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>orderNumber<span class="token punctuation">)</span> total <span class="token keyword">from</span> customers c
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> orders o <span class="token keyword">ON</span> c<span class="token punctuation">.</span>customerNumber <span class="token operator">=</span> o<span class="token punctuation">.</span>customerNumber
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> customerName <span class="token keyword">HAVING</span> total <span class="token operator">&gt;=</span> <span class="token number">5</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> total <span class="token keyword">DESC</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>ORDER BY排序数据</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- ORDER BY 默认升序 ASC，可以多列排序，可以使用组合列排序以及AS的别名</span>
<span class="token keyword">SELECT</span> orderNumber<span class="token punctuation">,</span> quantityOrdered <span class="token operator">*</span> priceEach <span class="token keyword">AS</span> subtotal <span class="token keyword">FROM</span> orderdetails <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> orderNumber<span class="token punctuation">,</span> subtotal <span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span> <span class="token number">100</span><span class="token punctuation">;</span>

<span class="token comment">-- 使用FIELD()自定义排序</span>
<span class="token keyword">SELECT</span> orderNumber<span class="token punctuation">,</span> <span class="token keyword">status</span> <span class="token keyword">FROM</span> orders <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> FIELD<span class="token punctuation">(</span><span class="token keyword">status</span><span class="token punctuation">,</span> <span class="token string">'In Process'</span><span class="token punctuation">,</span> <span class="token string">'On Hold'</span><span class="token punctuation">,</span> <span class="token string">'Cancelled'</span><span class="token punctuation">,</span> <span class="token string">'Resolved'</span><span class="token punctuation">,</span> <span class="token string">'Disputed'</span><span class="token punctuation">,</span> <span class="token string">'Shipped'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 想要1a、2a、10a而不是1a、10a、2a的顺序，参考[自然排序](https://www.yiibai.com/mysql/natural-sorting.html)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>连接表
<ul><li><a href="https://www.yiibai.com/mysql/inner-join.html" target="_blank" rel="noopener noreferrer">INNER JOIN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><code>例如t1的连接列有1,a,3三行数据; t2的连接列有2,a,4三行数据 那么结果集：连接列(a)-t1列(值)-t2列(值)</code></li> <li><a href="https://www.yiibai.com/mysql/left-join.html" target="_blank" rel="noopener noreferrer">LEFT JOIN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><code>例如t1的连接列有1,a,3三行数据; t2的连接列有2,a,4三行数据 那么结果集：连接列(1)-t1列(值)-t2列(NULL)、连接列(a)-t1列(值)-t2列(值)、连接列(3)-t1列(值)-t2列(NULL)</code></li> <li><a href="https://www.yiibai.com/mysql/cross-join.html" target="_blank" rel="noopener noreferrer">CROSS JOIN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><code>无需指定连接列，例如t1有两行数据t1c1,t1c2; t2有两行数据t2c1,t2c2;那么结果集就会有2*2行数据：t1c1-t2c1,t1c1-t2c2,t1c2-t2c1,t1c2-t2c2</code></li> <li><a href="https://www.yiibai.com/mysql/self-join.html" target="_blank" rel="noopener noreferrer">自连接<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>ON (USING) 规定连接条件</li></ul></li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- INNER JOIN 连接产品线和产品两张表，查出产品的代码和名称，产品线的描述信息</span>
<span class="token keyword">SELECT</span> t1<span class="token punctuation">.</span>productCode<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>productName<span class="token punctuation">,</span> t2<span class="token punctuation">.</span>textDescription
<span class="token keyword">FROM</span> products t1 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> productlines t2 <span class="token keyword">ON</span> t1<span class="token punctuation">.</span>productLine <span class="token operator">=</span> t2<span class="token punctuation">.</span>productLine
<span class="token keyword">LIMIT</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token comment">-- 当两张表连接的列名相同，可以使用USING简化写法，但是可读性会降低</span>
<span class="token keyword">SELECT</span> productCode<span class="token punctuation">,</span> productName<span class="token punctuation">,</span> textDescription
<span class="token keyword">FROM</span> products <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> productlines <span class="token keyword">USING</span> <span class="token punctuation">(</span>productline<span class="token punctuation">)</span>
<span class="token keyword">LIMIT</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token comment">-- LEFT JOIN 连接客户表和订单表，查出所有客户及其订单信息，即便该客户没有订单也要显示，此时订单相关的列会自动填出NULL</span>
<span class="token keyword">SELECT</span> c<span class="token punctuation">.</span>customerNumber<span class="token punctuation">,</span> c<span class="token punctuation">.</span>customerName<span class="token punctuation">,</span> orderNumber<span class="token punctuation">,</span> o<span class="token punctuation">.</span><span class="token keyword">status</span>
<span class="token keyword">FROM</span> customers c <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> orders o <span class="token keyword">ON</span> c<span class="token punctuation">.</span>customerNumber <span class="token operator">=</span> o<span class="token punctuation">.</span>customerNumber<span class="token punctuation">;</span>
<span class="token comment">-- 加上IS NULL可以简单地找到没有订单的客户</span>
<span class="token keyword">SELECT</span> c<span class="token punctuation">.</span>customerNumber<span class="token punctuation">,</span> c<span class="token punctuation">.</span>customerName<span class="token punctuation">,</span> orderNumber<span class="token punctuation">,</span> o<span class="token punctuation">.</span><span class="token keyword">status</span>
<span class="token keyword">FROM</span> customers c <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> orders o <span class="token keyword">ON</span> c<span class="token punctuation">.</span>customerNumber <span class="token operator">=</span> o<span class="token punctuation">.</span>customerNumber
<span class="token keyword">WHERE</span> orderNumber <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>

<span class="token comment">-- CROSS JOIN 会将同名的列加上编号，例如customerNumber(1)</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> customers <span class="token keyword">CROSS</span> <span class="token keyword">JOIN</span> orders <span class="token keyword">LIMIT</span> <span class="token number">20</span><span class="token punctuation">;</span>

<span class="token comment">-- 自连接，因为连接的表是自身，所以必须设置别名。</span>
<span class="token comment">-- 例如通过自连接显示employees表的组织结构：显示每个员工以及对应的上级，所以左连接；其中总经理没有上级，所以通过IFNULL给manager列设置特殊值'总经理'</span>
<span class="token keyword">SELECT</span> CONCAT<span class="token punctuation">(</span>e<span class="token punctuation">.</span>lastName<span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>firstName<span class="token punctuation">)</span> <span class="token keyword">AS</span> employee<span class="token punctuation">,</span>
IFNULL<span class="token punctuation">(</span>CONCAT<span class="token punctuation">(</span>m<span class="token punctuation">.</span>lastName<span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span>firstName<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'总经理'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> manager
<span class="token keyword">FROM</span> employees e <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> employees m <span class="token keyword">ON</span> e<span class="token punctuation">.</span>reportsTo <span class="token operator">=</span> m<span class="token punctuation">.</span>employeeNumber
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> manager <span class="token keyword">DESC</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><ul><li>Group By分组
<ul><li>如果有WHERE语句，需要放在它的后面</li> <li>可以按照多列分组</li> <li>可以按照表达式分组</li> <li>通过HAVING 添加分组条件</li></ul></li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 每个订单都有status状态 SELECT status FROM orders;</span>
<span class="token comment">-- Group By分组后，可以统计出每种status有多少订单</span>
<span class="token keyword">SELECT</span> <span class="token keyword">status</span><span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> total <span class="token keyword">FROM</span> orders <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">status</span><span class="token punctuation">;</span>
<span class="token comment">-- 按照表达式分组，注意在标准SQL中不允许GROUP BY中使用别名，例如：统计出每年已完成的订单的总额</span>
<span class="token keyword">SELECT</span> <span class="token keyword">YEAR</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>orderDate<span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token keyword">year</span><span class="token punctuation">,</span>
<span class="token function">SUM</span><span class="token punctuation">(</span>od<span class="token punctuation">.</span>quantityOrdered <span class="token operator">*</span> od<span class="token punctuation">.</span>priceEach<span class="token punctuation">)</span> <span class="token keyword">AS</span> total
<span class="token keyword">FROM</span> orders o <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> orderdetails od <span class="token keyword">ON</span> o<span class="token punctuation">.</span>orderNumber <span class="token operator">=</span> od<span class="token punctuation">.</span>orderNumber
<span class="token keyword">WHERE</span> <span class="token keyword">status</span> <span class="token operator">=</span> <span class="token string">'Shipped'</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">YEAR</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>orderDate<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- HAVING 添加分组条件，例如：统计出2013年后，每年已完成的订单的总额</span>
<span class="token keyword">SELECT</span> <span class="token keyword">YEAR</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>orderDate<span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token keyword">year</span><span class="token punctuation">,</span> <span class="token function">SUM</span><span class="token punctuation">(</span>od<span class="token punctuation">.</span>quantityOrdered <span class="token operator">*</span> od<span class="token punctuation">.</span>priceEach<span class="token punctuation">)</span> <span class="token keyword">AS</span> total
<span class="token keyword">FROM</span> orders o <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> orderdetails od <span class="token keyword">ON</span> o<span class="token punctuation">.</span>orderNumber <span class="token operator">=</span> od<span class="token punctuation">.</span>orderNumber
<span class="token keyword">WHERE</span> <span class="token keyword">status</span> <span class="token operator">=</span> <span class="token string">'Shipped'</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">year</span> <span class="token keyword">HAVING</span> <span class="token keyword">year</span> <span class="token operator">&gt;</span> <span class="token number">2013</span><span class="token punctuation">;</span>
<span class="token comment">-- 多列分组例子</span>
<span class="token keyword">SELECT</span> a<span class="token punctuation">.</span>orderNumber<span class="token punctuation">,</span> <span class="token keyword">status</span><span class="token punctuation">,</span> <span class="token function">SUM</span><span class="token punctuation">(</span>quantityOrdered <span class="token operator">*</span> priceEach<span class="token punctuation">)</span> total
<span class="token keyword">FROM</span> orderdetails a <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> orders b <span class="token keyword">ON</span> a<span class="token punctuation">.</span>orderNumber <span class="token operator">=</span> b<span class="token punctuation">.</span>orderNumber
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> orderNumber<span class="token punctuation">,</span> <span class="token keyword">status</span>
<span class="token keyword">HAVING</span> <span class="token keyword">status</span> <span class="token operator">=</span> <span class="token string">'Shipped'</span> <span class="token operator">AND</span> total <span class="token operator">&gt;</span> <span class="token number">55000</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="mysql-修改数据"><a href="#mysql-修改数据" class="header-anchor">#</a> mysql - 修改数据</h2> <ul><li>INSERT INTO 添加数据</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 为了演示，先创建tasks表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> tasks <span class="token punctuation">(</span>
    task_id <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
    subject <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    start_date <span class="token keyword">DATE</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    end_date <span class="token keyword">DATE</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    description <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>task_id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>
<span class="token comment">-- INSERT INTO 添加一条数据</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tasks<span class="token punctuation">(</span>subject<span class="token punctuation">,</span>start_date<span class="token punctuation">,</span>end_date<span class="token punctuation">,</span>description<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'Learn MySQL INSERT'</span><span class="token punctuation">,</span><span class="token string">'2017-07-21'</span><span class="token punctuation">,</span><span class="token string">'2017-07-22'</span><span class="token punctuation">,</span><span class="token string">'Start learning..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- INSERT INTO 添加多条数据</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tasks<span class="token punctuation">(</span>subject<span class="token punctuation">,</span>start_date<span class="token punctuation">,</span>end_date<span class="token punctuation">,</span>description<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'任务-1'</span><span class="token punctuation">,</span><span class="token string">'2017-01-01'</span><span class="token punctuation">,</span><span class="token string">'2017-01-02'</span><span class="token punctuation">,</span><span class="token string">'Description 1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span><span class="token string">'任务-2'</span><span class="token punctuation">,</span><span class="token string">'2017-01-01'</span><span class="token punctuation">,</span><span class="token string">'2017-01-02'</span><span class="token punctuation">,</span><span class="token string">'Description 2'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span><span class="token string">'任务-3'</span><span class="token punctuation">,</span><span class="token string">'2017-01-01'</span><span class="token punctuation">,</span><span class="token string">'2017-01-02'</span><span class="token punctuation">,</span><span class="token string">'Description 3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 具有SELECT子句的INSERT：可以实现表复制</span>
<span class="token comment">-- 先复制tasks表结构到tasks_bak</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> tasks_bak <span class="token operator">LIKE</span> tasks<span class="token punctuation">;</span>
<span class="token comment">-- 再复制表数据到tasks_bak</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tasks_bak
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">from</span> tasks<span class="token punctuation">;</span>

<span class="token comment">-- 当添加的新行违反主键(PRIMARY KEY)约束，MySQL会发生错误</span>
<span class="token comment">-- 此时可以通过ON DUPLICATE KEY UPDATE处理，添加到下一行（或者修改该行）</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tasks<span class="token punctuation">(</span>task_id<span class="token punctuation">,</span>subject<span class="token punctuation">,</span>start_date<span class="token punctuation">,</span>end_date<span class="token punctuation">,</span>description<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">'Test'</span><span class="token punctuation">,</span><span class="token string">'2017-01-01'</span><span class="token punctuation">,</span><span class="token string">'2017-01-02'</span><span class="token punctuation">,</span><span class="token string">'Next Priority'</span><span class="token punctuation">)</span>
<span class="token keyword">ON</span> <span class="token keyword">DUPLICATE</span> <span class="token keyword">KEY</span> <span class="token keyword">UPDATE</span>
task_id <span class="token operator">=</span> task_id <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> subject <span class="token operator">=</span> <span class="token string">'Test ON DUPLICATE KEY UPDATE'</span><span class="token punctuation">;</span>

<span class="token comment">-- INSERT IGNORE INTO：忽略插入过程中发生错误的行，让其他行也能正常插入，而不是让整个语句失效</span>
<span class="token comment">-- 为了演示，创建包含唯一(UNIQUE)约束email的subscribers表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> subscribers <span class="token punctuation">(</span>
    id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
    email <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">UNIQUE</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 先添加一行数据到subscribers表</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> subscribers<span class="token punctuation">(</span>email<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'yiibai.com@gmail.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 添加多行数据：违反唯一约束的行不受影响，其他行正常插入</span>
<span class="token keyword">INSERT</span> <span class="token keyword">IGNORE</span> <span class="token keyword">INTO</span> subscribers<span class="token punctuation">(</span>email<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'yiibai.com@gmail.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'jane.max@ibm.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- [参考](https://www.yiibai.com/mysql/insert-ignore.html)：需要注意的是，使用了IGNORE后插入违反字段长度的行，不会报错，而是截断后再插入</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><ul><li>UPDATE 更新数据</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- UPDATE 更新一行数据</span>
<span class="token keyword">UPDATE</span> employees 
<span class="token keyword">SET</span> lastname <span class="token operator">=</span> <span class="token string">'Hill'</span><span class="token punctuation">,</span> email <span class="token operator">=</span> <span class="token string">'mary.hill@yiibai.com'</span>
<span class="token keyword">WHERE</span> employeeNumber <span class="token operator">=</span> <span class="token number">1056</span><span class="token punctuation">;</span>

<span class="token comment">-- 具有SELECT子句的UPDATE：可以从其他表获取数据进行更新</span>
<span class="token keyword">UPDATE</span> tasks_bak 
<span class="token keyword">SET</span> subject <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> subject <span class="token keyword">FROM</span> tasks <span class="token keyword">WHERE</span> task_id <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">WHERE</span> task_id <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>

<span class="token comment">-- UPDATE 更新多行数据</span>
<span class="token comment">-- 先说明生成42位随机字符串的方式：因为md5只有32位，所以要拼接。可以通过select查看结果</span>
<span class="token keyword">select</span> concat<span class="token punctuation">(</span>substring<span class="token punctuation">(</span>md5<span class="token punctuation">(</span>rand<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  md5<span class="token punctuation">(</span>rand<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 将随机字符串更新到每一行数据中</span>
<span class="token keyword">UPDATE</span> tasks_bak 
<span class="token keyword">SET</span> description <span class="token operator">=</span> concat<span class="token punctuation">(</span>substring<span class="token punctuation">(</span>md5<span class="token punctuation">(</span>rand<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  md5<span class="token punctuation">(</span>rand<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ul><li>UPDATE JOIN 跨表更新</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 先创建演示环境：empdb数据库、employees员工表、merits绩效表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> empdb<span class="token punctuation">;</span>
<span class="token keyword">USE</span> empdb<span class="token punctuation">;</span>
<span class="token comment">-- create tables</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> merits <span class="token punctuation">(</span>
    performance <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    percentage <span class="token keyword">FLOAT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>performance<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> employees <span class="token punctuation">(</span>
    emp_id <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
    emp_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    performance <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    salary <span class="token keyword">FLOAT</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>emp_id<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">CONSTRAINT</span> fk_performance <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>performance<span class="token punctuation">)</span>
        <span class="token keyword">REFERENCES</span> merits <span class="token punctuation">(</span>performance<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- insert data for merits table</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> merits<span class="token punctuation">(</span>performance<span class="token punctuation">,</span>percentage<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0.01</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">0.03</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">0.05</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">0.08</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- insert data for employees table</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> employees<span class="token punctuation">(</span>emp_name<span class="token punctuation">,</span>performance<span class="token punctuation">,</span>salary<span class="token punctuation">)</span>      
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'Mary Doe'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">50000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token string">'Cindy Minsu'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">65000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token string">'Sue Greenspan'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">75000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token string">'Grace Dell'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">125000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token string">'Nancy Johnson'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">85000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token string">'John Doe'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">45000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token string">'Lily Bush'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">55000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- UPDATE INNER JOIN：根据绩效percentage调整工资</span>
<span class="token keyword">UPDATE</span> employees <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> merits <span class="token keyword">ON</span> employees<span class="token punctuation">.</span>performance <span class="token operator">=</span> merits<span class="token punctuation">.</span>performance 
<span class="token keyword">SET</span> salary <span class="token operator">=</span> salary <span class="token operator">+</span> salary <span class="token operator">*</span> merits<span class="token punctuation">.</span>percentage<span class="token punctuation">;</span>
<span class="token comment">-- 如果新增了两名还没有绩效percentage的员工</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> employees<span class="token punctuation">(</span>emp_name<span class="token punctuation">,</span>performance<span class="token punctuation">,</span>salary<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'Jack William'</span><span class="token punctuation">,</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token number">43000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token string">'Ricky Bond'</span><span class="token punctuation">,</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token number">52000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 可以通过UPDATE LEFT JOIN 调整他们的工资</span>
<span class="token keyword">UPDATE</span> employees <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> merits <span class="token keyword">ON</span> employees<span class="token punctuation">.</span>performance <span class="token operator">=</span> merits<span class="token punctuation">.</span>performance 
<span class="token keyword">SET</span> salary <span class="token operator">=</span> salary <span class="token operator">+</span> salary <span class="token operator">*</span> <span class="token number">0.015</span>
<span class="token keyword">WHERE</span> merits<span class="token punctuation">.</span>percentage <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><ul><li>DELETE 删除数据</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- DELETE 删除一行数据</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> tasks_bak <span class="token keyword">WHERE</span> task_id <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token comment">-- DELETE 删除N行数据：需要结合ORDER BY，否则可能删除意料之外的结果</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> tasks_bak <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token identifier"><span class="token punctuation">`</span>subject<span class="token punctuation">`</span></span> <span class="token keyword">LIMIT</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token comment">-- DELETE 删除每一行数据</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> tasks_bak<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>ON DELETE CASCADE 级联删除：需要存储引擎支持外键(如InnoDB)</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 先创建演示环境：建筑物(buildings)和房间(rooms)表</span>
<span class="token keyword">use</span> empdb<span class="token punctuation">;</span>
<span class="token comment">-- 创建buildings表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> buildings <span class="token punctuation">(</span>
    building_no <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
    building_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    address <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>
<span class="token punctuation">)</span><span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>
<span class="token comment">-- 创建rooms表：注意设置了ON DELETE CASCADE级联删除</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> rooms <span class="token punctuation">(</span>
    room_no <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
    room_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    building_no <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>building_no<span class="token punctuation">)</span>
        <span class="token keyword">REFERENCES</span> buildings <span class="token punctuation">(</span>building_no<span class="token punctuation">)</span>
        <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span>
<span class="token punctuation">)</span><span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>
<span class="token comment">-- 添加数据</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> buildings<span class="token punctuation">(</span>building_name<span class="token punctuation">,</span>address<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'海南大厦'</span><span class="token punctuation">,</span><span class="token string">'海口市国兴大道1234号'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token string">'万达水城'</span><span class="token punctuation">,</span><span class="token string">'海口市大同路1200号'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> rooms<span class="token punctuation">(</span>room_name<span class="token punctuation">,</span>building_no<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'Amazon'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token string">'War Room'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token string">'Office of CEO'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token string">'Marketing'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token string">'Showroom'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 删除2号建筑</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> buildings <span class="token keyword">WHERE</span> building_no <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token comment">-- 由于设置了级联删除，引用2号建筑的房间也会被删除</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">from</span> rooms<span class="token punctuation">;</span>
<span class="token comment">-- 在删除数据之前，可以查询系统表，查看是否有级联关系的表，防止删除意料之外的数据</span>
<span class="token keyword">USE</span> information_schema<span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> table_name <span class="token keyword">FROM</span> referential_constraints
<span class="token keyword">WHERE</span>
    constraint_schema <span class="token operator">=</span> <span class="token string">'empdb'</span>
        <span class="token operator">AND</span> referenced_table_name <span class="token operator">=</span> <span class="token string">'buildings'</span>
        <span class="token operator">AND</span> delete_rule <span class="token operator">=</span> <span class="token string">'CASCADE'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><ul><li>DELETE JOIN 跨表删除数据：和级联删除一样，可以删除相关联的数据。相较而言，级联删除更方便但也更隐蔽。</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 创建演示环境: t1表和t2表，两张表无外键关系，通过t2.ref =&gt; t1.id关联</span>
<span class="token keyword">use</span> empdb<span class="token punctuation">;</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> t1<span class="token punctuation">,</span> t2<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t1 <span class="token punctuation">(</span>
    id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t2 <span class="token punctuation">(</span>
    id <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    ref <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> t1 <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> t2<span class="token punctuation">(</span>id<span class="token punctuation">,</span> ref<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'C'</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 通过DELETE INNER JOIN 删除t1中id为1的记录，以及t2中ref为1的数据</span>
<span class="token keyword">DELETE</span> t1<span class="token punctuation">,</span> t2
<span class="token keyword">FROM</span> t1 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> t2 <span class="token keyword">ON</span> t2<span class="token punctuation">.</span>ref <span class="token operator">=</span> t1<span class="token punctuation">.</span>id 
<span class="token keyword">WHERE</span> t1<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">-- 给t1增加两条记录，但t2没有引用这些记录的数据</span>
<span class="token keyword">INSERT</span> <span class="token keyword">into</span> t1 <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 通过DELETE INNER JOIN 删除t1中没有被引用的记录</span>
<span class="token keyword">DELETE</span> t1
<span class="token keyword">FROM</span> t1 <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> t2 <span class="token keyword">ON</span> t2<span class="token punctuation">.</span>ref <span class="token operator">=</span> t1<span class="token punctuation">.</span>id
<span class="token keyword">WHERE</span> t2<span class="token punctuation">.</span>ref <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><ul><li><a href="https://www.yiibai.com/mysql/replace.html" target="_blank" rel="noopener noreferrer">REPLACE替换数据<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：个人不常用，可由insert和update替代</li></ul> <h2 id="mysql-子查询"><a href="#mysql-子查询" class="header-anchor">#</a> mysql - 子查询</h2> <ul><li>子查询是嵌套在另一个查询(如SELECT，INSERT，UPDATE或DELETE)中的查询。 另外，MySQL子查询可以嵌套在另一个子查询中
<ul><li>独立子查询：没有使用外部查询中的数据的子查询，可以独立执行，可以作为派生表</li> <li>相关子查询：使用了外部查询中的数据的子查询</li></ul></li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- WHERE子查询-返回多个结果，可以使用IN (NOT IN)</span>
<span class="token comment">-- 例如，查询在位于美国(USA)的办公室工作的员工</span>
<span class="token keyword">SELECT</span> lastName<span class="token punctuation">,</span> firstName <span class="token keyword">FROM</span> employees
<span class="token keyword">WHERE</span> officeCode <span class="token operator">IN</span>
<span class="token punctuation">(</span><span class="token keyword">SELECT</span> officeCode <span class="token keyword">FROM</span> offices <span class="token keyword">WHERE</span> country <span class="token operator">=</span> <span class="token string">'USA'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- WHERE子查询-返回单个结果，可以使用比较运算符</span>
<span class="token comment">-- 例如，查询交易额最高的订单：除了使用排序加limit，还可以利用子查询</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> orderdetails
<span class="token keyword">WHERE</span> quantityOrdered <span class="token operator">*</span> priceEach <span class="token operator">=</span> 
<span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>quantityOrdered <span class="token operator">*</span> priceEach<span class="token punctuation">)</span> <span class="token keyword">from</span> orderdetails<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- FROM子查询：在子查询结果集中进行查询</span>
<span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">MIN</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token punctuation">,</span> FLOOR<span class="token punctuation">(</span><span class="token function">AVG</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">FROM</span>
    <span class="token punctuation">(</span><span class="token keyword">SELECT</span> orderNumber<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>orderNumber<span class="token punctuation">)</span> <span class="token keyword">AS</span> items <span class="token keyword">FROM</span> orderdetails
    <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> orderNumber<span class="token punctuation">)</span> <span class="token keyword">AS</span> lineitems<span class="token punctuation">;</span>

<span class="token comment">-- 相关子查询 相关的子查询取决于外部查询，对外部查询中的每一行对相关子查询进行一次评估</span>
<span class="token comment">-- 例如，查询购买价格高于每个产品线中的产品的平均购买价格的产品。由于不同的产品的产品线可能不同，当前行产品线的平均价格需要通过相关子查询得出</span>
<span class="token keyword">SELECT</span> productname<span class="token punctuation">,</span> buyprice<span class="token punctuation">,</span> productline <span class="token keyword">FROM</span> products p1
<span class="token keyword">WHERE</span> buyprice <span class="token operator">&gt;</span> 
<span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>buyprice<span class="token punctuation">)</span> <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> productline <span class="token operator">=</span> p1<span class="token punctuation">.</span>productline<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- WHERE EXISTS(NOT EXISTS)子查询</span>
<span class="token comment">-- 例子：查找至少有一个总额大于60000的销售订单的客户信息，关键在于相关子查询中的WHERE条件</span>
<span class="token comment">-- 有点难理解，或许可以自己再造一个例子</span>
<span class="token keyword">SELECT</span> customerNumber<span class="token punctuation">,</span> customerName
<span class="token keyword">FROM</span> customers
<span class="token keyword">WHERE</span>
    <span class="token keyword">EXISTS</span><span class="token punctuation">(</span> <span class="token keyword">SELECT</span> orderNumber<span class="token punctuation">,</span> <span class="token function">SUM</span><span class="token punctuation">(</span>priceEach <span class="token operator">*</span> quantityOrdered<span class="token punctuation">)</span>
        <span class="token keyword">FROM</span> orderdetails <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> orders <span class="token keyword">USING</span> <span class="token punctuation">(</span>orderNumber<span class="token punctuation">)</span>
        <span class="token keyword">WHERE</span> customerNumber <span class="token operator">=</span> customers<span class="token punctuation">.</span>customerNumber
        <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> orderNumber
        <span class="token keyword">HAVING</span> <span class="token function">SUM</span><span class="token punctuation">(</span>priceEach <span class="token operator">*</span> quantityOrdered<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">60000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 派生表：给独立子查询的结果设置别名，简化复杂查询</span>
<span class="token keyword">SELECT</span> column_list
<span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> column_list <span class="token keyword">FROM</span> table_1<span class="token punctuation">)</span> derived_table_name<span class="token punctuation">;</span>
<span class="token keyword">WHERE</span> derived_table_name<span class="token punctuation">.</span>c1 <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><h2 id="mysql-cte-公共表达式"><a href="#mysql-cte-公共表达式" class="header-anchor">#</a> mysql - CTE（公共表达式）</h2> <ul><li>需要mysql8以上</li> <li><a href="https://www.yiibai.com/mysql/cte.html" target="_blank" rel="noopener noreferrer">参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="mysql-准备语句"><a href="#mysql-准备语句" class="header-anchor">#</a> mysql - 准备语句</h2> <ul><li>准备语句：执行带占位符的查询，可以提高查询的速度，并使您的查询更安全。</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">PREPARE</span> stmt1 <span class="token keyword">FROM</span> <span class="token string">'SELECT productCode, productName FROM products WHERE productCode = ?'</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> <span class="token variable">@pc</span> <span class="token operator">=</span> <span class="token string">'S10_1678'</span><span class="token punctuation">;</span>
<span class="token keyword">EXECUTE</span> stmt1 <span class="token keyword">USING</span> <span class="token variable">@pc</span><span class="token punctuation">;</span>
<span class="token keyword">DEALLOCATE</span> <span class="token keyword">PREPARE</span> stmt1<span class="token punctuation">;</span>
<span class="token comment">-- 使用PREPARE准备语句。SELECT语句根据指定的产品代码从products表查询产品数据。问号(?)作为产品代码的占位符。</span>
<span class="token comment">-- 接下来，声明了一个产品代码变量@pc，并将其值设置为S10_1678。</span>
<span class="token comment">-- 然后，使用EXECUTE语句来执行产品代码变量@pc的准备语句。</span>
<span class="token comment">-- 最后，我们使用DEALLOCATE PREPARE来发布PREPARE语句。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="mysql-临时表"><a href="#mysql-临时表" class="header-anchor">#</a> mysql - 临时表</h2> <ul><li>临时表是一种特殊类型的表，它允许您存储一个临时结果集，可以在单个会话中多次重用。</li> <li>当会话结束或连接终止时，MySQL会自动删除临时表。当您不再使用临时表时，也可以使用DROP TABLE语句来显式删除临时表</li> <li>注意：临时表可以与数据库中的普通表具有相同的名称，但不推荐这么做，因为会容易误操作</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 创建临时表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TEMPORARY</span> <span class="token keyword">TABLE</span> top10customers
<span class="token keyword">SELECT</span> p<span class="token punctuation">.</span>customerNumber<span class="token punctuation">,</span> 
       c<span class="token punctuation">.</span>customerName<span class="token punctuation">,</span> 
       <span class="token function">FORMAT</span><span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>amount<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> total
<span class="token keyword">FROM</span> payments p
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> customers c <span class="token keyword">ON</span> c<span class="token punctuation">.</span>customerNumber <span class="token operator">=</span> p<span class="token punctuation">.</span>customerNumber
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> p<span class="token punctuation">.</span>customerNumber
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> total <span class="token keyword">DESC</span>
<span class="token keyword">LIMIT</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token comment">-- 之后的操作需要在同义词会话中执行，重新连接数据库后就无法操作</span>
<span class="token comment">-- 查询临时表</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> top10customers<span class="token punctuation">;</span>

<span class="token comment">-- 删除临时表（即使不删除，mysql在会话结束时会自动删除，但使用持久池时难把握删除的时机，当不需要临时表时进行手动删除会更好）</span>
<span class="token keyword">DROP</span> <span class="token keyword">TEMPORARY</span> <span class="token keyword">TABLE</span> top10customers<span class="token punctuation">;</span>

<span class="token comment">-- </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="mysql-视图"><a href="#mysql-视图" class="header-anchor">#</a> mysql - 视图</h2> <ul><li><a href="https://www.yiibai.com/mysql/views.html" target="_blank" rel="noopener noreferrer">参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>数据库系统将数据库视图存储为具有连接的SQL SELECT语句。当表的数据发生变化时，视图也反映了这些数据的变化</li> <li>MySQL不像：Oracle，PostgreSQL等其他数据库系统那样支持物理视图，MySQL是不支持物理视图的。</li> <li>不能在视图上创建索引</li> <li>如果删除或重命名视图所基于的表，则MySQL不会发出任何错误。但是，MySQL会使视图无效。 可以使用<code>CHECK TABLE</code>语句来检查视图是否有效。</li> <li>简单的视图可以更新表中数据。基于具有连接，子查询等的复杂SELECT语句创建的视图无法更新。<a href="https://www.yiibai.com/mysql/create-sql-updatable-views.html" target="_blank" rel="noopener noreferrer">参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.yiibai.com/mysql/introduction-sql-views.html" target="_blank" rel="noopener noreferrer">优缺点<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 创建视图</span>
<span class="token comment">-- 注意：其中的SELECT语句不能包含FROM子查询、不能引用变量、不能引用准备语句</span>
<span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> SalePerOrder <span class="token keyword">AS</span>
    <span class="token keyword">SELECT</span> 
        orderNumber<span class="token punctuation">,</span> <span class="token function">SUM</span><span class="token punctuation">(</span>quantityOrdered <span class="token operator">*</span> priceEach<span class="token punctuation">)</span> total
    <span class="token keyword">FROM</span>
        orderdetails
    <span class="token keyword">GROUP</span> <span class="token keyword">by</span> orderNumber
    <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> total <span class="token keyword">DESC</span><span class="token punctuation">;</span>
<span class="token comment">-- 基于视图创建视图</span>
<span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> BigSalesOrder <span class="token keyword">AS</span>
    <span class="token keyword">SELECT</span> 
        orderNumber<span class="token punctuation">,</span> <span class="token function">ROUND</span><span class="token punctuation">(</span>total<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">as</span> total
    <span class="token keyword">FROM</span>
        SalePerOrder
    <span class="token keyword">WHERE</span>
        total <span class="token operator">&gt;</span> <span class="token number">60000</span><span class="token punctuation">;</span>

<span class="token comment">-- 查询视图</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> SalePerOrder<span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> BigSalesOrder<span class="token punctuation">;</span>

<span class="token comment">-- 可以通过查看所有表和视图</span>
<span class="token keyword">SHOW</span> <span class="token keyword">FULL</span> <span class="token keyword">TABLES</span><span class="token punctuation">;</span>

<span class="token comment">-- 可更新视图：可新增、修改、删除视图的数据，并同步到基表</span>
<span class="token comment">-- 创建可更新视图</span>
<span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> officeInfo
 <span class="token keyword">AS</span>  <span class="token keyword">SELECT</span> officeCode<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> city <span class="token keyword">FROM</span> offices<span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> officeInfo<span class="token punctuation">;</span>
<span class="token comment">-- 修改可更新视图</span>
<span class="token keyword">UPDATE</span> officeInfo <span class="token keyword">SET</span> phone <span class="token operator">=</span> <span class="token string">'+86 089866668888'</span> <span class="token keyword">WHERE</span> officeCode <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token comment">-- 查看修改结果</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> officeInfo <span class="token keyword">WHERE</span> officeCode <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> offices <span class="token keyword">WHERE</span> officeCode <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token comment">-- 查询yiibaidb数据库获取所有视图，并显示哪些视图是可更新的</span>
<span class="token keyword">SELECT</span> 
    table_name<span class="token punctuation">,</span> is_updatable
<span class="token keyword">FROM</span>
    information_schema<span class="token punctuation">.</span>views
<span class="token keyword">WHERE</span>
    table_schema <span class="token operator">=</span> <span class="token string">'yiibaidb'</span><span class="token punctuation">;</span>

<span class="token comment">-- 可更新视图的一致性问题：</span>
<span class="token comment">-- https://www.yiibai.com/mysql/view-with-check-option.html</span>
<span class="token comment">-- https://www.yiibai.com/mysql/view-local-cascaded-in-with-check-option.html</span>

<span class="token comment">-- 管理视图：</span>
<span class="token comment">-- 查看视图定义</span>
<span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> officeInfo<span class="token punctuation">;</span>
<span class="token comment">-- 修改视图</span>
<span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">VIEW</span> v_contacts
  <span class="token keyword">AS</span> <span class="token keyword">SELECT</span> firstName<span class="token punctuation">,</span> lastName<span class="token punctuation">,</span> extension<span class="token punctuation">,</span> email <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
<span class="token comment">-- 删除视图</span>
<span class="token keyword">DROP</span> <span class="token keyword">VIEW</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> organization<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><h2 id="mysql-触发器"><a href="#mysql-触发器" class="header-anchor">#</a> mysql - 触发器</h2> <ul><li><a href="https://www.yiibai.com/mysql/triggers.html" target="_blank" rel="noopener noreferrer">参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>SQL触发器是存储在数据库目录中的一组SQL语句。每当与表相关联的事件发生时，即会执行或触发SQL触发器，例如插入，更新或删除。</li> <li><a href="https://www.yiibai.com/mysql/sql-triggers.html" target="_blank" rel="noopener noreferrer">优缺点<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="mysql-全文搜索"><a href="#mysql-全文搜索" class="header-anchor">#</a> mysql - 全文搜索</h2> <ul><li><a href="https://www.yiibai.com/mysql/full-text-search.html" target="_blank" rel="noopener noreferrer">参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>在MySQL 5.6或更高版本中，只有MyISAM和InnoDB存储引擎支持全文搜索。</li> <li>MySQL全文搜索引擎中定义的搜索项的最小长度为4，这意味着如果搜索长度小于4的关键字，例如car，cat等，则不会得到任何结果。</li> <li>MySQL根据其相关性对结果集中的行进行排序，如果有多个关键字，优先返回匹配到多个关键字的记录</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 基于products表的productline列创建FULLTEXT索引</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> products <span class="token keyword">ADD</span> FULLTEXT<span class="token punctuation">(</span>productline<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 查询products表中productline列包含Classic或Vintage的记录，不区分大小写</span>
<span class="token keyword">SELECT</span> productName<span class="token punctuation">,</span> productline <span class="token keyword">FROM</span> products
<span class="token keyword">WHERE</span> <span class="token keyword">MATCH</span><span class="token punctuation">(</span>productline<span class="token punctuation">)</span> AGAINST<span class="token punctuation">(</span><span class="token string">'Classic,Vintage'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/tree-blog/assets/js/app.cb601673.js" defer></script><script src="/tree-blog/assets/js/2.5b88b558.js" defer></script><script src="/tree-blog/assets/js/14.3f58ed78.js" defer></script>
  </body>
</html>
